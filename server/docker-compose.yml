services:
  # api:
  #   build: .
  #   env_file: .env
  #   depends_on:
  #     - postgres
  #     - redis
  #     - opensearch
  #     - qdrant
  #     - neo4j
  #     - ollama
  #   ports:
  #     - "8080:8080"
  #   volumes:
  #     - uploads:/data/uploads

  postgres:
    image: postgres:latest
    environment:
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_DB: proto
    volumes:
      - "pgdata:/var/lib/postgresql"
      - "./db/init:/docker-entrypoint-initdb.d"
    ports:
      - "5432:5432"

  opensearch:
    image: opensearchproject/opensearch:latest
    environment:
      OPENSEARCH_INITIAL_ADMIN_PASSWORD: ${OPENSEARCH_ADMIN_PASSWORD}
      discovery.type: single-node
      plugins.security.disabled: "true"
      OPENSEARCH_JAVA_OPTS: "-Xms1g -Xmx1g"
    ports:
      - "9200:9200"
      - "9600:9600"
    volumes:
      - "osdata:/usr/share/opensearch/data"

  qdrant:
    image: qdrant/qdrant:latest
    ports:
      - "6333:6333"
    volumes:
      - "qdrant:/qdrant/storage"

  neo4j:
    image: neo4j:5-community
    environment:
      NEO4J_AUTH: ${NEO4J_USER}/${NEO4J_PASSWORD}
      NEO4J_PLUGINS: '["apoc"]'
      NEO4J_ACCEPT_LICENSE_AGREEMENT: yes
      NEO4J_dbms_security_procedures_unrestricted: "apoc.*"
    ports:
      - "7474:7474"
      - "7687:7687"
    volumes:
      - "neo4j:/data"
      
  redis:
    image: redis:latest
    ports:
      - "6379:6379"

  ollama:
    image: ollama/ollama:latest
    ports:
      - "11434:11434"
    volumes:
      - "ollama:/root/.ollama"
    deploy:
      resources:
        reservations:
          devices:
            - capabilities: ["gpu"]

volumes:
  pgdata: {}
  osdata: {}
  qdrant: {}
  neo4j: {}
  uploads: {}
  ollama: {}
